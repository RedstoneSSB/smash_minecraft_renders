# smash_minecraft_renders
A Rust library and CLI program for creating Minecraft renders for Smash Ultimate using software rendering.

> [!NOTE]
> This code was designed specifically for use in [smash-minecraft-skins](https://github.com/jam1garner/smash-minecraft-skins). Users wishing to create their own renders should consider using a dedicated 3D modeling and rendering program like Blender for superior performance and image quality.

## Overview
Rendering relies on pregenerated input textures with `(U, V, lighting, alpha)` for the RGBA channels. Channel packing improves data locality and reduces the number of costly image sampling operations. Pregenerating the textures also allows antialiasing for edges to be precomputed. The rendering code acts like the screenspace lighting calculated in the pixel shader in deferred rendering. This greatly simplifies the implementation but requires careful handling of render order of input images for proper depth sorting.

## Skin Texture Input
The input skin textures are expected to be in the Minecraft Java layout, which is also used for Smash Ultimate. See the included `sample.png` for reference.  

Input textures should be precorrected using the following formula to avoid over exposing the render and more closely match Smash Ultimate's textures.
This is equivalent to a levels adjustment with highlight output set to `184` and midtone output set to `1.386` or `output.rgb = (input.rgb ^ 0.72) * 0.72`.

## Generating Correct Input Images
### Mesh
![steve_legs_blender](https://github.com/ScanMountGoat/smash_minecraft_renders/assets/23301691/97088c06-d618-438e-8938-8cadb5af9d3f)

Input images are generated from meshes in Blender matched to the official render. This requires matching the perspective of the camera used in the official render. Rather than match the perspective of the camera for the entire render, each portion of the model like the arm or body uses its own Blender scene with a camera matched to that specific box model using [fspy](https://fspy.io/) and its Blender addon. The perspective of each model can be matched simply by scaling and translating a Blender cube along the appropriate axes without any rotation required. Rendering a connected mesh for each part of the model like the arm or head also avoids any seams along face boundaries that would result from simply perspective warping an image plane for each face.

### UV (RG)
The generated UV map should have vertices snapped to pixel corners and be exported without antialiasing or dithering. Filtering will negatively impact the accuracy of the texture sampling. This can be achieved in Blender by setting view transform to `Raw`, dither to `0.00`, and samples to `1`. See the provided `uvs.png` for the expected dimensions and layout. The main limitation with this approach is that the texture color uses only a single UV value and thus a single sample per pixel. The higher sample counts for other channels and bilinear filtering for the final render resizing reduce some of the visual impact of the lower sample count in practice.

### Lighting (B)
Lighting maps are generated by dividing the official renders by the texture color in an image editor like Photoshop or Gimp. This will result in pixel values brighter than 1.0, so the final image is divided by 4 (multiply by 0.25) to fit the result into an 8-bit PNG file. The lighting textures require substantial manual cleanup due to inaccuracies in aligning the texture colors to the rendered image. Lighting is typically low frequency, so blurring is effective at removing artifacts along non edges.

### Alpha (A)
The alpha channel is extracted from a render with a high sample count to improve the antialiasing quality.

## CLI Usage
`minecraft_render.exe [FLAGS] --skin <sample.png>`  
`minecraft_render.exe -h` for a list of arguments and options.    

Creates the following files:  
```
chara_3_custom.png
chara_4_custom.png
chara_6_custom.png
output.png
```

